# אפיון מסך "עסקאות שנבחנות מחדש"

## סקירה כללית
המסך הזה מתבסס על מסך החיפוש הקיים ומשתמש בשאילתה הבסיסית `select * from bank_scraper_pending_transactions where status = 'reviewed'`.  
המשתמש מבצע חיפוש לפי שם עסק, ואז אנחנו מציגים את כל העסקאות במצב `reviewed` שתואמות את שם העסק הזה, כמו שמתקבלת בשאילתה:
```
select * from bank_scraper_pending_transactions
where status = 'reviewed'
  and business_name = '<החיפוש>'
```
כל תוצאה מציגה סטטוסים ופרטי תשלום רלוונטיים, וניתן לבחור עסקאות כדי להחזיר אותן למצב `pending`.

## ניווט וקישור למסך
- כדי להגיע למסך החדש המשתמש ילחץ על גלגל השיניים בצד שמאל למעלה בעמוד הראשי (ה־RTL נרצה שהוא יופיע בתחילתו של ה־App Bar).  
- לחיצה על גלגל השיניים תעביר למסך הגדרות, שבו יופיע כפתור חדש (ייתכן ככרטיס או כפתור עם אייקון) שמוביל למסך "עסקאות שנבחנות מחדש".  
- על המסך הזה נציג ביקורת מיידית אם יש גישה – אם אין הרשאה, הכפתור יציג Tooltip עם הסבר קצר.

## זרימת מסך
1. **שורת חיפוש** – שדה טקסט עם placeholder בעברית (למשל: "חפש עסק לפי שם"). במהלך ההקלדה נבצע debounce של 500ms, פניה לשרת תרוץ רק אם יש לפחות 3 תווים. כדי לספק תחושה של מהלך חיפוש קיים, נציג טקסט קטן מתחת לשדה עם ה־query שנשלח, לדוגמה:  
   ```
   select * from bank_scraper_pending_transactions
   where status = 'reviewed'
     and business_name like '%יין בעיר%'
   ```  
   (ה־query נשמר גם בלוג כדי לאבחן עומסי חיפוש).
2. **תוצאת החיפוש** – רשימה (ניתן לוותר על גלילה אינסופית אם התוצאות מוגבלות) שבה כל שורה מייצגת עסקה.  
3. **סינון מיידי** – אם אין תוצאה תוצג הודעה "לא נמצאו עסקאות שתואמות את החיפוש".
4. **בחירת עסקאות** – כל שורה תכלול checkbox (או לחצן בחירה פשוט) המאפשר לבחור עסקאות מרובות.
5. **כפתור "החזר ל-pending"** – מופעל רק כשנבחרה לפחות עסקה אחת. בלחיצה עולים תהליך ווידוא (תיבת דיאלוג): "האם להחזיר את העסקאות שנבחרו למצב pending?" עם שני כפתורים – אישור וביטול.
6. **פידבק** – אחרי הביצוע נציג Toast/Alert קצר המיידע על מספר העסקאות שהוחזרו. נעביר גם אינדיקציה ויזואלית (פחות בולט/בורדר אפור) לעסקאות שהוחזרו בהצלחה אם הרשימה נשארת פתוחה.

## צורת הצגה לפרטי עסקה (RTL)
כל האלמנטים יוצגו ימינה לשמאל – הכותרות בצד ימין והנתונים בצד שמאל של הכרטיסים.  
| שדה | תוכן |
|-----|------|
| `business_name` | שם העסק (גישה ראשית), טקסט מודגש וכפתור מידע קטן מימין לקבלת פרטים נוספים |
| `category_name` | הקטגוריה המשויכת, בצד ימין של הכרטיס |
| `payment_date` | תאריך התשלום בפורמט `YYYY-MM-DD` |
| `payment_month` | החודש ששימש לתזרים, לצד תווית קטנה "חודש תזרים" |
| `amount` | הסכום כולל מטבע, טקסט בצבע איבוד/קבלה בהתאם לערך |

| שדה | תוכן |
|-----|------|
| `business_name` | שם העסק (גישה ראשית) |
| `category_name` | הקטגוריה המשויכת |
| `payment_date` | תאריך התשלום בפורמט `YYYY-MM-DD` |
| `payment_month` | החודש ששימש לתזרים, ולידו גם `flow_month` (פחות דגשי) |
| `amount` | הסכום כולל מטבע |

כל שורה יכולה לכלול גם שדות משניים כמו `payment_method` או `notes` בצדדים או ב-hover details כדי לא להעמיס.

## הרשאות/קריאות
1. קריאה: `GET /transactions?status=reviewed&businessName=<query>`  
2. שינוי סטטוס: `POST /transactions/status` עם `body` מסוג JSON:  
```json
{
  "transaction_ids": [867, ...],
  "status": "pending"
}
```
3. אחרי תשובה חיובית נעדכן את הרשימה (נבצע refetch מבוסס חיפוש פעיל).

## תרחישים / בדיקות
- חיפוש עם שם שפועל – בהצגה צריך להופיע לפחות סיכום של עסק ואפשרות בחירה.
- חיפוש ללא תוצאה – תצוגת תחליף.
- חיפוש ב-`reviewed` קיים – כפתור ההחזרה מופעל, פעולה נחטפת בהצלחה, מציג הפניה לסטטוס `pending`.
- ידנית מבוצעת ההחזרה עבור עסקאות שנבחרו – מספר ה-IDs נשלח ומתקבל אישור. אם התגובה כשלונה, נשאר עם טקסט שגיאה.

## תצוגת UI/UX
- שדה חיפוש בראש עם icon זכוכית מגדלת מימין לשדה ותווית small המציינת "חיפוש פעיל" יחד עם ה־query בפורמט SQL.  
- רשימת תוצאות בצורת כרטיסים, כל אחד מציג מצוין ימני עם סדר RTL: checkbox (שמאל הכרטיס) → פרטי תאריך וסכום → שם עסק וקטגוריה בצד ימין.  
- מתחת לרשימה כפתור פעולה עליון (מימין) – "החזר ל-pending" עם אייקון חץ שמאלה.  
- סוגי feedback כגון Tooltip ו־SnackBar בהתאם, הטקסטים מיושרים לימין.  
- בצד שמאל (מלמעלה) אפשרות להוסיף בעתיד סינון משני לפי קטגוריה, אך כרגע לא חובה.

## חוויית חיפוש חיה (Live Search)
- במהלך הקלדה נבצע debounce של 500ms כדי לא להעמיס. אם המשתמש עוצר, הרכיב שולח את ה־query.  
- כשיש טקסט בשדה, מתחתיו מופיע טאץ' קצר שמתאר את השאילתה שנבחרה והסטטוס (למשל: "מחפש לפיו: `status = 'reviewed' AND business_name = 'יין בעיר'`").  
- אם המשתמש מוחק או מוחק חלק מהטקסט, הקריאה תתעדכן בהתאם רק לאחר ההשהיה המאופיינת.  

## ניטור ואבטחה
- יש לוודא שהקריאות נשמרות תחת אותו scopes כמו מסכי תפעול אחרים.  
- אם המשתמש אינו מורשה לשנות סטטוס, הכפתור יהיה מושתק והתראת Tooltip תגיד "אין הרשאה".

## קובץ README רלוונטי
- לצרכים עתידיים, להזכיר למפתחים לעדכן תיעוד ב-README או בכלי ה-api כאשר מוסיפים שדות חדשים.
