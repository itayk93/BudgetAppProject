# תכנית אפיון אופרטיבית לשדרוג לוח הבקרה

**חשוב:** קרא את הקובץ הזה לפני התחלת יישום כל שינוי. הוא מפרט את תשתית העבודה, הפערים מול האפיון שהוצג והשלבים שהמערכת הנוכחית צריכה לעבור כדי להגיע לחוויה המבוקשת. אין להשתמש בשם שצוין באפיון המקורי; נתייחס רק ל״הלוח״ או ״המערכת״.

## 1. חזון מרכזי
- ללמד את ממשק `BudgetApp` להרגיש כמו לוח ניהול פיננסי מודרני: צבעי שמנת ירוקים וכחולים, כרטיסים עם קיפולי תוכן, כפתורי פעולה בולטים וטקסט עברי רציף עם נגישות למובייל.
- להרחיב את `CashflowCardsView` כך שיכלול לא רק סיכומים כלליים (הכנסות, החסכונות והקטגוריות) אלא גם כרטיסים מובילים לילדים: השבועי שנותר להוציא, היעד החודשי, מסלולי תכנון עתידיים, חיפוש וסינון ועוד.
- לבנות חוויות נלוות (כפתור Riseup היומי, חלון עו״ש, פאנלים של חיפוש/סינון) תוך שימוש בשכבת `ViewModel` קיימת ולא ליצור ארכיטקטורה חדשה.

## 2. מצב קיים (תיעוד מהירה)
- `RootView` (BudgetApp/RootView.swift) כבר מנהל את בחירת המסך הראשי, על בסיס `AppState` ו־`CashFlowDashboardViewModel`.
- `CashflowCardsView` מרכז את הדף עם כותרת חודשית, כפתור הגדרות, כרטיס סיכום, רשימה של `Item` שמגיעה מה־ViewModel ועוד כרטיסים עבור הכנסות, חסכונות וקטגוריות.
- הנתונים מגיעים מ־`CashFlowDashboardViewModel` (BudgetApp/ViewModels/CashFlowDashboardViewModel.swift), הכולל מבנה `Item` עם `income`, `savings`, `nonCashflow`, קבוצות משותפות וקטגוריות, ושירותי API קיימים.
- כבר קיימים סקרים כגון `PendingTransactionsReviewView` ו־`PendingTransactionsReviewViewModel` שיכולים לשמש כנקודת התחלה לחיפוש/משימות יומיות.

## 3. פערים מרכזיים מול האפיון
| נושא | מה חסר היום |
|-| - |
| **כרטיס ״כמה נשאר להוציא השבוע״** | אין כרטיס מובלט שמתמקד בהוצאות משתנות שבועיות עם חישוב נותר ויכולת לפתוח פירוט שבועי. |
| **כרטיס ״היעד החודשי״** | אין כרטיס מול היעד עם כפתור עריכה/הצעה/קישור לתכנון גדול. |
| **ניהול תכנון עתידי** | אין אזור שמציג תכניות חיסכון (ריק/מוכן) או מאפשר פתיחת צ׳ק-ליסט לגבי אירועים עתידיים. |
| **Riseup היומי** | אין כפתור צף ירוק עם לוח משימות/תזכורות יומיות שניתן לגרור/לסמן. |
| **חיפוש וסינון** | אין לחצני זכוכית מגדלת/משפך שמוציאים מודלים נפרדים לשליפה לפי תאריכים, חשבונות או פרמטרים. |
| **קטגוריות משתנות וקבועות** | אמנם יש מחלקות לקטגוריות, אך חסרים אינדיקטורים צבעוניים מותאמים, חיווי חריגה, כיווני האור ועימוד המדגיש את ההדללות. |
| **הפקדות לחיסכון והוצאות קבועות** | אין חלוקה ברורה בין הפקדות קבועות/חד־פעמיות או אזור שמציג הוצאות קבועות בפני עצמן. |
| **הכנסות** | קיימות רשימות, אך חסרה חלוקה מקוטבת (קבועות/משתנות). |
| **סטטוס עו״ש/חייבים** | כפתור ״ומה מצב העו״ש״ עדיין אינו מיושם. |
| **עיצוב/נגישות** | אין מערכת משתני צבעים/פונטים, ואין קטעי `focus`/`aria` (SwiftUI equivalents) כמו `accessibilityLabel`, `focusable` או `transition` חלק. |

## 4. זרימת העבודה המוצעת

### 4.1. פיתוח הכרטיסים והכותרת
1. לכלול Header חדש עם שם חודש, חץ חזרה/התקדמות, כפתורי חיפוש/סינון, והוספת `ToolbarItem` עבור כפתור עו״ש.
2. להקים `CardView` חד-משמעי ב־`Views/Common` שיתמוך בפינות עגולות, צללים, רקעים ירוקים/כחולים, אינדיקטורים צבעוניים ו־`transition` למעבר פתיחה/סגירה.
3. להוסיף כרטיס „כמה נשאר להוצאות השבוע“ עם נתון בולט ירוק, סטטוס חריגה, כפתור „ומה מצב העו״ש?“ (הפנייה ל־View נפרד), ואפשרות להרחבה עם רשומות שבועיות (מעין `WeeklyGrid` ב־`CashflowCardsView`).
4. להוסיף כרטיס „יעד חודשי“ שמציג יעד חיסכון, סטטוס, כפתור „לעריכה“ (שיפתח `EditTargetView`) וכפתור “לתכנן קדימה” שמציג מודל תכנונים עתידיים.

### 4.2. אינטראקציות קטגוריות והרחבות
1. לשפר את `CategorySummaryCard` כדי להציג פס התקדמות צבעוני (ירוק/כתום/אדום) בהתאם לתוצאה מול היעד; להוסיף טקסט מפורט „נשאר/חריגה״ ו־`DisclosureGroup` לפירוט שבועי/חודשי.
2. להוסיף אייקונים קטנים לצד הכותרות (מובנה ב־SF Symbols או ערכת אייקונים מותאמת).
3. להקפיד על `ForEach(..., id: \.id)` בהתאם להנחיות ולהשתמש ב־`Group`/`Section` כדי לשמור על מבנה משמעותי.
4. לספק גישה לפעולות עתידיות (תפריט שלוש נקודות) באמצעות `Menu` עם אפשרויות עריכה/הסרה/הסתרה, אך עדכון הפונקציות רק בממשק (שעדיין לא פותח בפועל). להימנע מהפעלת פעולות מסוכנות בקוד.

### 4.3. חיפוש, סינון והדפסה בעזרת `ViewSheets`
1. ליצור `SearchSheetView` שמעבד תיבת חיפוש (כולל `TextField`,`Toolbar`, `Cancel`) ומזין תנאי פילטר לתצוגת `Transaction`.
2. לבנות `FilterSheetView` עם רשימת חשבונות/כרטיסים (`ForEach` על `appState.accounts` או מחרוזת נבחרת), צ׳קבוקסים ו־`Button("הצג")`.
3. להוסיף `@State` או `@Published` חדש ב־ViewModel לשמירת פילטרים; להבטיח שה־API (או השדה) יוכל לקבל את הסינון בעת ריענון הנתונים.

### 4.4. Riseup היומי ותפריט צף
1. להוסיף כפתור צף ירוק (בסגנון `FloatingActionButton`) עם תגית מספרית של משימות. הכפתור יפתח `DailyTasksSheet` שמציג רשימת משימות (`TaskSummary`), כולל האפשרות לגרור/לסמן (ניתן להחליף ב־`SwipeActions` או `Button` עם סטטוס).
2. המידע יכול לבוא מתוך `PendingTransactionsReviewViewModel` או מתוך `MockTaskManager`. נשתמש ב־`PendingTransactions` לייצר תזכורות כגון „עדכן תחזית״, „חקור חריגות״ ועוד.
3. להוסיף אנימציית `pulse` כשיש משימות חדשות (IP/`Animation` קצרה).

### 4.5. מצב עו״ש וחיובים עתידיים
1. להוסיף `AccountStatusView` מופעל דרך כפתור בכרטיס השבועי. הכרטיס יציג רשימת חשבונות (מ־`AppState` / `CashFlow`) עם יתרות ולוח חיובים עתידי.
2. המודול ישתמש ב־`List`/`LazyVStack` ויכלול `HStack` עם שם, מספר חשבון והיתרה; ניתן להוסיף תאריך עדכון אחרון וסטטוס חיובי (ירוק).
3. להציג פס יום/חיוב גם בכרטיסי כרטיסי אשראי לפי `PendingTransactions`.

### 4.6. עיצוב, צבעים ונגישות
1. להוסיף קובץ חדש `Theme.swift` או הרחבת `Color+Extensions` שבו נגדיר משתנים `Color` קבועים (`creamBackground`, `cardBackground`, `primary`, `success`, `warning`, `danger`, `muted`).
2. להשתמש ב־`Font.custom("Heebo")` או `Font.system` עם `weight` מותאם; להגדיר `TextStyle` אחיד לכותרות ומשתמשים והנמכת טקסט משני.
3. להוסיף `RoundedRectangle` עם `shadow` רגיל, `transition(.opacity.combined(with: .move(edge: .top)))`, `animation(.easeOut(duration: 0.25))` לכל פתיחת כרטיס.
4. לוודא יחס ניגוד 4.5:1 לפחות (בדוק באמצעות `foregroundColor` פונקציה שמחוללת גוון כהה/בהיר), להוסיף `accessibilityLabel` לכל כפתור, `onTapGesture` עם `accessibilityAddTraits(.isButton)` ו־`.focusable(true)` לנגיעות.
5. להרחיב `ViewModifiers` כדי לטפל ב־`:focusVisible` (SwiftUI equivalent: `.overlay` עם `@FocusState`) לקליטה במקלדת.
6. להגדיר `ColorScheme` מותאם כדי להבטיח קריאות גם במצב Dark (למרות שמערכת תומכת יותר ב־light).

### 4.7. ניהול מצב ומודלים
1. להוסיף שדות חדשים ל־`CashFlowDashboardViewModel` כמו `weeklyBudgetRemaining`, `monthlyTargetInfo`, `selectedFilter`, `dailyTasks`, `accountsSnapshot`.
2. לוודא שימוש ב־`@Published`/`@State` ולא לשנות טיפוסי `struct` קיימים לפי ההנחיות (נתקן באמצעות יצירת עצמים חדשים).
3. למפות את הנתונים מה־API להרכבת כרטיסים חדשים (לדוגמה: הוצאות שבועיות מתוך `category.weekly`, חשבונות מתוך `CashFlow.accounts`, מטרות מתוך `MonthlyGoal`).
4. לבנות טסטים ידניים/קומנטאריים לבדיקת נקודות פתיחה: `Task`/`TaskGroup`/`Transaction`/`Category`.

## 5. תוצרים מוסכמים
- לכל כרטיס (Weekly, Monthly Target, Savings, Income) יהיה `CardFrame` מאוחד.
- כל כפתור יכלול `accessibilityLabel`, `keyboardShortcut` רלוונטי (במסך iPad), ו־`Tooltip` קצר עם `help(...)` (אם רלוונטי).
- המאקרו יישמר במצב RTL באמצעות `.environment(\.layoutDirection, .rightToLeft)` כפי שמתרחש היום.
- המודלים החדשים ייחסרו לתסריט הנוכחי וימנעו שינויים ארכיטקטוניים גדולים.

## 6. בדיקות מומלצות לפני יישום
- להריץ את האפליקציה בבדיקת `simulator` (iPhone 15) ולהתמקד בחלקי כרטיסים חדשים.
- לוודא שהאייקונים (כגון חיפוש, משפך, שלוש נקודות) ברוחב קליק מינימלי 44px.
- לבדוק את זמינות ה־sheet והפוקוס במקלדת בכרגעים של פתיחת חיפוש/סינון/שבוע.
- בכל שינוי UI להקפיד שאף שינוי לא יגרום לאזהרות של `SwiftUI ViewBuilder` או `ForEach` לפי ההנחיות.

## 7. ניהול תיעוד והמשך עבודה
- בכל שלב, הפעל `git status` כדי לוודא שלא נוצרו שינויים לא מתוכננים.
- אם מוסיפים קבצים חדשים (לדוגמה, `DailyTasksSheet.swift`), הרשום אותם ב־`README.md` או ב־`GUIDELINES.md` אם נדרש.
- שמור הערות על רעיונות שנראים טוב לשלב הבא (למשל: גרף עוגה, יצוא נתונים), אבל אל תיישם ללא קבלת אישור נוסף.

## 8. סטטוס יישום כרגע
- יישמתי את מבנה הכרטיסים החדש: כותרת חודש עם חיפוש/סינון, כרטיס ״כמה נשאר להוציא השבוע״ ועוד כרטיס ״יעד חודשי״ עם עריכה וטפסים (`BudgetApp/Views/CashflowCardsView.swift`, `Theme.swift`, `Extensions/ColorExtensions.swift`).
- שדרגתי את אינטראקציות הקטגוריות, כולל תגיות מצב, פאנלים נפתחים עם Weekly/Monthly, והתשתית ל־search/filter/account sheets (`CashflowCardsView.swift:803-1068`, `ViewModels/CashFlowDashboardViewModel.swift:149-205`).
- בניתי את ״Riseup היומי״, ״לתכנן קדימה״ וכפתור צף דינמי עם אנימציות, משימות/תכניות ותיאורי נגישות; `DailyTasksSheet` ו־`PlanAheadSheet` מספקים זרימה היקפית (נתונים נבנים מתוך קטגוריות פעילויות וכך מהדהדים את היעדים הקיימים).
- הוספתי את `FocusRingButtonStyle` ושיפצתי את גישת ה־accessibility לכפתורים מרכזיים וכרטיסים חדשים (`BudgetApp/ButtonStyles.swift`, שבילים שונים ב־`CashflowCardsView.swift`).
- נדרש לבדוק: חלונות ה־sheet החדשים, האינטראקציות עם משימות, תיוג ה־badges כשיש חריגה, והשפעת `FocusRing` על חיפוש/סינון במקלדת.
- טיפולי סינון מתקדמים: הממשק עכשיו מאפשר להזין טווח סכומים ותאריכים שמצמצמים את החיפוש (`TransactionFilterSheet` ו־`TransactionSearchSheet`), לכן נסה להגדיר טווחים ולוודא שהחיפוש מכבד אותם.
